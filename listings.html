<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profesionales – COLMENA HUB</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-yellow: #FBBF24;
      --primary-blue: #3B82F6;
    }
    
    body {
      background: #F9FAFB;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    }
    
    .professional-card {
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }
    
    .professional-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }
    
    .verified-badge {
      position: relative;
      padding-left: 20px;
    }
    
    .verified-badge::before {
      content: '✓';
      position: absolute;
      left: 0;
      top: 0;
      width: 16px;
      height: 16px;
      background: #10B981;
      color: white;
      border-radius: 50%;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .rating-stars {
      color: #FBBF24;
      letter-spacing: 2px;
    }
    
    .filter-pill {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .filter-pill.active {
      background: var(--primary-yellow);
      color: white;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <a href="index.html" class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center">
              <i class="fas fa-bee text-white"></i>
            </div>
            <span class="text-lg font-bold text-gray-900">COLMENA HUB</span>
          </a>
          <div class="hidden md:block text-sm text-gray-500">
            <i class="fas fa-chevron-right mx-2"></i>
            <span id="category-title">Cargando...</span>
          </div>
        </div>
        <a href="apply.html" class="text-sm text-amber-600 hover:text-amber-700 font-medium">
          <i class="fas fa-user-plus mr-1"></i>Regístrate
        </a>
      </div>
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="max-w-7xl mx-auto px-4 py-8">
    <!-- Encabezado de categoría -->
    <div class="mb-8">
      <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
        <div>
          <h1 id="category-header" class="text-3xl font-bold text-gray-900 mb-2">Cargando...</h1>
          <p id="category-description" class="text-gray-600">Buscando profesionales...</p>
        </div>
        <div class="mt-4 md:mt-0">
          <span id="professional-count" class="inline-block bg-amber-100 text-amber-800 px-4 py-2 rounded-full font-medium">
            <i class="fas fa-spinner fa-spin mr-2"></i>Cargando...
          </span>
        </div>
      </div>
      
      <!-- Filtros -->
      <div class="bg-white rounded-xl p-4 mb-6 shadow-sm">
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="text-sm text-gray-600 mr-3">Filtrar por:</span>
          <span class="filter-pill px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm active" data-filter="all">Todos</span>
          <span class="filter-pill px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="available">Disponibles ahora</span>
          <span class="filter-pill px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="top-rated">Mejor calificados</span>
          <span class="filter-pill px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm" data-filter="experienced">+5 años exp.</span>
        </div>
        
        <div class="relative">
          <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          <input type="text" 
                 id="search-professionals" 
                 placeholder="Buscar profesionales por nombre, ubicación o especialidad..." 
                 class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:border-amber-300 focus:ring-2 focus:ring-amber-200 outline-none">
        </div>
      </div>
    </div>

    <!-- Lista de profesionales -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="professionals-list">
      <!-- Los profesionales se cargarán aquí dinámicamente -->
      <div class="col-span-full text-center py-12">
        <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-spinner fa-spin text-amber-500 text-2xl"></i>
        </div>
        <p class="text-gray-600">Cargando profesionales...</p>
      </div>
    </div>

    <!-- Sin resultados -->
    <div id="no-results" class="hidden text-center py-12">
      <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-search text-gray-400 text-2xl"></i>
      </div>
      <h3 class="text-xl font-bold text-gray-700 mb-3">No se encontraron profesionales</h3>
      <p class="text-gray-600 max-w-md mx-auto mb-6">
        No hay profesionales disponibles en esta categoría en este momento.
        Prueba con otra categoría o regístrate para ser el primero.
      </p>
      <a href="oficiadores.html" class="inline-block bg-amber-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-amber-600 transition-colors mr-3">
        <i class="fas fa-arrow-left mr-2"></i>Ver otras categorías
      </a>
      <a href="apply.html" class="inline-block border border-amber-500 text-amber-600 px-6 py-3 rounded-lg font-medium hover:bg-amber-50 transition-colors">
        <i class="fas fa-user-plus mr-2"></i>Regístrate
      </a>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-50 border-t border-gray-200 mt-12">
    <div class="max-w-7xl mx-auto px-4 py-8">
      <div class="text-center">
        <div class="flex items-center justify-center space-x-3 mb-4">
          <div class="w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center">
            <i class="fas fa-bee text-white"></i>
          </div>
          <span class="text-lg font-bold text-gray-900">COLMENA HUB</span>
        </div>
        <p class="text-gray-600 text-sm">Conectando talento verificado con oportunidades reales</p>
        <div class="flex justify-center space-x-6 mt-6">
          <a href="index.html" class="text-sm text-gray-500 hover:text-amber-600">Inicio</a>
          <a href="oficiadores.html" class="text-sm text-gray-500 hover:text-amber-600">Oficiadores</a>
          <a href="professions-list.html" class="text-sm text-gray-500 hover:text-amber-600">Profesionistas</a>
          <a href="politica-privacidad.html" class="text-sm text-gray-500 hover:text-amber-600">Privacidad</a>
        </div>
        <p class="text-gray-400 text-xs mt-6">© 2024 COLMENA HUB. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Firebase y scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    // Configuración de Firebase (reemplaza con tu configuración)
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_DOMINIO.firebaseapp.com",
      projectId: "TU_PROYECTO_ID",
      storageBucket: "TU_PROYECTO.appspot.com",
      messagingSenderId: "TU_SENDER_ID",
      appId: "TU_APP_ID"
    };

    // Inicializar Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    // Variables globales
    let allProfessionals = [];
    let currentFilter = 'all';
    let currentSearch = '';

    // Obtener categoría de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('category') || 'Electricista';

    // Configurar títulos
    document.getElementById('category-title').textContent = category;
    document.getElementById('category-header').textContent = category + 's Disponibles';

    // Cargar profesionales
    async function loadProfessionals() {
      try {
        const professionalsRef = db.collection('professionals');
        const snapshot = await professionalsRef
          .where('profession', '==', category)
          .where('verified', '==', true)
          .get();

        allProfessionals = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          allProfessionals.push({
            id: doc.id,
            ...data,
            // Asegurar campos requeridos
            fullName: data.fullName || 'Nombre no disponible',
            location: data.location || 'Ubicación no especificada',
            rating: data.rating || 0,
            experienceYears: data.experienceYears || 'No especificada',
            availableNow: data.availableNow || false,
            photoURL: data.photoURL || 'https://via.placeholder.com/100'
          });
        });

        updateProfessionalCount();
        renderProfessionals();
        
      } catch (error) {
        console.error('Error al cargar profesionales:', error);
        document.getElementById('professionals-list').innerHTML = `
          <div class="col-span-full text-center py-12">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-700 mb-3">Error al cargar</h3>
            <p class="text-gray-600">No se pudieron cargar los profesionales. Intenta más tarde.</p>
          </div>
        `;
      }
    }

    // Renderizar profesionales
    function renderProfessionals() {
      const container = document.getElementById('professionals-list');
      const noResultsDiv = document.getElementById('no-results');
      
      // Filtrar profesionales
      let filtered = allProfessionals.filter(prof => {
        // Filtro de búsqueda
        const searchMatch = currentSearch === '' || 
          prof.fullName.toLowerCase().includes(currentSearch) ||
          prof.location.toLowerCase().includes(currentSearch) ||
          (prof.specialties && prof.specialties.toLowerCase().includes(currentSearch));
        
        // Filtros adicionales
        if (currentFilter === 'available') {
          return searchMatch && prof.availableNow;
        } else if (currentFilter === 'top-rated') {
          return searchMatch && prof.rating >= 4.5;
        } else if (currentFilter === 'experienced') {
          return searchMatch && parseInt(prof.experienceYears) >= 5;
        }
        
        return searchMatch;
      });

      // Mostrar/ocultar mensaje sin resultados
      if (filtered.length === 0) {
        container.innerHTML = '';
        noResultsDiv.classList.remove('hidden');
        return;
      } else {
        noResultsDiv.classList.add('hidden');
      }

      // Generar HTML
      container.innerHTML = filtered.map(prof => `
        <div class="professional-card bg-white rounded-xl p-5 shadow-sm border border-gray-100">
          <div class="flex items-start mb-4">
            <img src="${prof.photoURL}" 
                 alt="${prof.fullName}"
                 class="w-16 h-16 rounded-full object-cover border-2 border-amber-100">
            <div class="ml-4 flex-1">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="font-bold text-gray-900 text-lg">${prof.fullName}</h3>
                  <p class="text-sm text-gray-600">${prof.profession}</p>
                </div>
                ${prof.availableNow ? 
                  '<span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded">Disponible</span>' : 
                  '<span class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded">Ocupado</span>'}
              </div>
              
              <div class="flex items-center mt-2">
                <div class="rating-stars mr-2">
                  ${getStars(prof.rating)}
                </div>
                <span class="text-sm text-gray-600">(${prof.rating || 'Nuevo'})</span>
                <span class="verified-badge text-xs text-green-600 ml-4">Verificado</span>
              </div>
            </div>
          </div>
          
          <div class="mb-4">
            <p class="text-gray-700 text-sm line-clamp-2">
              ${prof.careerSummary || 'Profesional especializado en ' + prof.profession}
            </p>
          </div>
          
          <div class="flex flex-wrap gap-2 mb-4">
            <span class="inline-flex items-center text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded-full">
              <i class="fas fa-map-marker-alt mr-1 text-xs"></i>
              ${prof.location}
            </span>
            <span class="inline-flex items-center text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded-full">
              <i class="fas fa-briefcase mr-1 text-xs"></i>
              ${prof.experienceYears} años
            </span>
            ${prof.specialties ? `
              <span class="inline-flex items-center text-xs bg-amber-100 text-amber-800 px-3 py-1 rounded-full">
                <i class="fas fa-star mr-1 text-xs"></i>
                ${prof.specialties.split(',')[0]}
              </span>
            ` : ''}
          </div>
          
          <div class="flex space-x-3">
            <a href="profile-view.html?id=${prof.id}" 
               class="flex-1 bg-amber-500 text-white text-center py-2 rounded-lg font-medium hover:bg-amber-600 transition-colors">
              Ver Perfil
            </a>
            <button onclick="contactProfessional('${prof.id}')" 
                    class="flex-1 border border-amber-500 text-amber-600 py-2 rounded-lg font-medium hover:bg-amber-50 transition-colors">
              Contactar
            </button>
          </div>
        </div>
      `).join('');
    }

    // Función para generar estrellas
    function getStars(rating) {
      if (!rating || rating === 0) return '★★★★★';
      const fullStars = Math.floor(rating);
      const halfStar = rating % 1 >= 0.5 ? 1 : 0;
      const emptyStars = 5 - fullStars - halfStar;
      
      return '★'.repeat(fullStars) + 
             (halfStar ? '☆' : '') + 
             '☆'.repeat(emptyStars);
    }

    // Actualizar contador
    function updateProfessionalCount() {
      const count = allProfessionals.length;
      document.getElementById('professional-count').innerHTML = `
        <i class="fas fa-users mr-2"></i>
        ${count} profesional${count !== 1 ? 'es' : ''} disponible${count !== 1 ? 's' : ''}
      `;
    }

    // Contactar profesional
    function contactProfessional(id) {
      alert(`Redirigiendo al sistema de mensajería con el profesional ID: ${id}`);
      // En una implementación real, redirigirías a un sistema de chat
      // window.location.href = `chat.html?professionalId=${id}`;
    }

    // Configurar eventos
    function setupEventListeners() {
      // Filtros
      document.querySelectorAll('.filter-pill').forEach(pill => {
        pill.addEventListener('click', function() {
          // Remover active de todos
          document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
          // Agregar active al clickeado
          this.classList.add('active');
          currentFilter = this.dataset.filter;
          renderProfessionals();
        });
      });

      // Búsqueda
      const searchInput = document.getElementById('search-professionals');
      let searchTimeout;
      searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          currentSearch = this.value.toLowerCase().trim();
          renderProfessionals();
        }, 300);
      });

      // Clic en profesional para ver perfil (delegación de eventos)
      document.addEventListener('click', function(e) {
        if (e.target.closest('.professional-card')) {
          const card = e.target.closest('.professional-card');
          const profileLink = card.querySelector('a[href*="profile-view.html"]');
          if (profileLink && !e.target.closest('button')) {
            e.preventDefault();
            window.location.href = profileLink.href;
          }
        }
      });
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
      loadProfessionals();
      setupEventListeners();
      
      // Configurar descripción según categoría
      const descriptions = {
        'Electricista': 'Instalación y mantenimiento eléctrico certificado',
        'Plomero': 'Fontanería profesional y reparación de tuberías',
        'Carpintero': 'Trabajos en madera y muebles personalizados',
        // Agrega más descripciones según sea necesario
      };
      
      if (descriptions[category]) {
        document.getElementById('category-description').textContent = descriptions[category];
      }
    });
  </script>
</body>
</html>