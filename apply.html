<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Verificaci√≥n de Profesionales ‚Äì COLMENA HUB</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- SDK OFICIAL de Veriff -->
  <script src="https://cdn.veriff.com/incontext/js/veriff.min.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
  <style>
    :root { --primary-yellow: #FFD700; --secondary-brown: #8B4513; }
    body { background: linear-gradient(135deg, #FFF8DC 0%, #f5f5f5 100%); font-family: 'Segoe UI', sans-serif; }
    .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
    .btn-primary { background: linear-gradient(135deg, var(--primary-yellow), #FFA500); color: var(--secondary-brown); font-weight: 600; transition: all 0.3s ease; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    .progress-bar { height: 6px; background: linear-gradient(90deg, #4CAF50 0%, var(--primary-yellow) 100%); border-radius: 3px; transition: width 0.5s ease; }
    .error-message { color: #dc2626; font-size: 0.875rem; margin-top: 0.25rem; display: none; }
    .success-input { border-color: #10b981 !important; }
    .error-input { border-color: #dc2626 !important; }
    .professional-select { max-height: 300px; overflow-y: auto; }
    .professional-option { transition: all 0.2s; }
    .professional-option:hover { background-color: #fef3c7; }
    .category-header { background-color: #fbbf24; color: #78350f; font-weight: bold; padding: 8px 12px; margin-top: 8px; border-radius: 4px; }
    .country-emoji { font-size: 1.25rem; margin-right: 8px; }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white shadow-lg">
    <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="flex items-center space-x-3 mb-4 md:mb-0">
          <i class="fas fa-bee text-3xl"></i>
          <div>
            <h1 class="text-2xl font-bold">COLMENA HUB</h1>
            <p class="text-yellow-100 text-sm">Verificaci√≥n de Profesionales</p>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <span class="px-3 py-1 bg-white/20 rounded-full text-sm"><i class="fas fa-shield-alt mr-2"></i>Verificaci√≥n Segura</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Contenedor Principal -->
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Barra de Progreso -->
    <div class="glass-card rounded-xl p-6 mb-8">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h2 class="text-xl font-bold text-gray-800">Proceso de Verificaci√≥n</h2>
          <p class="text-gray-600">Completa todos los pasos para ser verificad@</p>
        </div>
        <span id="progress-text" class="font-bold text-yellow-600 text-lg">0/5</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2.5">
        <div id="progress-bar" class="progress-bar h-2.5 rounded-full" style="width: 0%"></div>
      </div>
      <div class="grid grid-cols-5 gap-4 mt-4">
        <div class="text-center"><div class="w-8 h-8 mx-auto bg-yellow-500 text-white rounded-full flex items-center justify-center mb-2">1</div><p class="text-xs font-medium">Informaci√≥n</p></div>
        <div class="text-center"><div class="w-8 h-8 mx-auto bg-gray-300 text-gray-600 rounded-full flex items-center justify-center mb-2">2</div><p class="text-xs text-gray-500">Veriff ID</p></div>
        <div class="text-center"><div class="w-8 h-8 mx-auto bg-gray-300 text-gray-600 rounded-full flex items-center justify-center mb-2">3</div><p class="text-xs text-gray-500">CV</p></div>
        <div class="text-center"><div class="w-8 h-8 mx-auto bg-gray-300 text-gray-600 rounded-full flex items-center justify-center mb-2">4</div><p class="text-xs text-gray-500">Documentos</p></div>
        <div class="text-center"><div class="w-8 h-8 mx-auto bg-gray-300 text-gray-600 rounded-full flex items-center justify-center mb-2">5</div><p class="text-xs text-gray-500">Revisi√≥n</p></div>
      </div>
    </div>

    <!-- Formulario Principal -->
    <div id="main-form" class="glass-card rounded-xl p-6">
      <form id="verification-form" class="space-y-8">
        <!-- Paso 1: Informaci√≥n B√°sica -->
        <section id="step-1" class="step">
          <h3 class="text-2xl font-bold text-gray-800 mb-6"><i class="fas fa-user-circle mr-3 text-yellow-500"></i>Informaci√≥n Personal</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Nombre Completo -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-user mr-2"></i>Nombre Completo *
                <span class="text-xs text-gray-500">(Escribe exactamente como aparece en tu INE)</span>
              </label>
              <input type="text" id="fullName" required 
                     class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition"
                     placeholder="Ej: Maria Guadalupe Garfias Sotelo"
                     oninput="autoCapitalize(this)"/>
              <div id="fullName-error" class="error-message">
                <i class="fas fa-exclamation-circle mr-1"></i> Escribe tu nombre exactamente como en tu INE
              </div>
            </div>

            <!-- Correo Electr√≥nico (solo Gmail) -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-envelope mr-2"></i>Correo Electr√≥nico *
                <span class="text-xs text-gray-500">(Solo Gmail)</span>
              </label>
              <div class="relative">
                <input type="email" id="email" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition pr-10"
                       placeholder="tucorreo@gmail.com"
                       onblur="validateGmail(this)"/>
                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                  <i class="fas fa-at text-gray-400"></i>
                </div>
              </div>
              <div id="email-error" class="error-message">
                <i class="fas fa-exclamation-circle mr-1"></i> Solo se aceptan correos de Gmail (@gmail.com)
              </div>
            </div>

            <!-- Tel√©fono (solo M√©xico y Colombia) -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-phone mr-2"></i>Tel√©fono *
                <span class="text-xs text-gray-500">(Solo M√©xico y Colombia)</span>
              </label>
              <div class="flex">
                <div class="relative flex-grow">
                  <input type="tel" id="phone" required 
                         class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition"
                         placeholder="Ej: 5523456789"
                         oninput="formatPhone(this)"
                         maxlength="15"/>
                  <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                    <span id="country-indicator" class="text-sm font-medium text-gray-500"></span>
                  </div>
                </div>
                <button type="button" onclick="toggleCountry()" 
                        class="ml-2 px-3 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition flex items-center min-w-[100px]">
                  <span id="current-emoji" class="country-emoji">üá≤üáΩ</span>
                  <span id="current-country" class="text-sm">+52</span>
                </button>
              </div>
              <div id="phone-error" class="error-message">
                <i class="fas fa-exclamation-circle mr-1"></i> Formato incorrecto. Usa 10 d√≠gitos.
              </div>
              <input type="hidden" id="country-code" value="52"/>
            </div>

            <!-- Profesi√≥n/Oficio (SELECT con todas las opciones) -->
            <div class="relative">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-briefcase mr-2"></i>Profesi√≥n/Oficio *
                <span class="text-xs text-gray-500">(Selecciona de la lista)</span>
              </label>
              <div class="relative">
                <input type="text" id="profession-search" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition"
                       placeholder="Busca o selecciona..."
                       onkeyup="filterProfessions()"
                       onclick="toggleProfessionDropdown()"
                       autocomplete="off"/>
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                  <i class="fas fa-chevron-down text-gray-400"></i>
                </div>
                <input type="hidden" id="profession" required/>
                
                <!-- Dropdown de profesiones -->
                <div id="profession-dropdown" 
                     class="absolute z-50 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-y-auto hidden">
                  <!-- Las opciones se cargan din√°micamente -->
                </div>
              </div>
              <div id="profession-error" class="error-message">
                <i class="fas fa-exclamation-circle mr-1"></i> Selecciona una profesi√≥n/oficio de la lista
              </div>
            </div>
          </div>
        </section>

        <!-- Paso 2: Verificaci√≥n con Veriff -->
        <section id="step-2" class="step hidden">
          <h3 class="text-2xl font-bold text-gray-800 mb-6"><i class="fas fa-shield-alt mr-3 text-green-500"></i>Verificaci√≥n de Identidad</h3>
          <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-6">
            <div class="flex items-start">
              <i class="fas fa-info-circle text-blue-500 text-xl mr-3 mt-1"></i>
              <div>
                <h4 class="font-bold text-blue-800 mb-2">Verificaci√≥n con Veriff</h4>
                <p class="text-blue-700">Sube foto de tu INE/IFE y toma una selfie. El proceso toma 2-3 minutos.</p>
                <p class="text-sm text-blue-600 mt-2"><i class="fas fa-lock mr-1"></i>Tus datos est√°n encriptados y seguros</p>
              </div>
            </div>
          </div>

          <!-- Contenedor donde aparecer√° Veriff -->
          <div id="veriff-container" class="min-h-[500px] border-2 border-dashed border-gray-300 rounded-xl p-4 mb-4">
            <div id="veriff-placeholder" class="text-center py-12">
              <i class="fas fa-id-card text-6xl text-gray-300 mb-4"></i>
              <h4 class="text-xl font-bold text-gray-700 mb-2">Verificaci√≥n de Identidad</h4>
              <p class="text-gray-600 mb-6">Haz clic para iniciar la verificaci√≥n</p>
              <button type="button" id="start-veriff-btn" class="btn-primary px-8 py-3 rounded-lg font-bold text-lg"><i class="fas fa-play mr-2"></i>Iniciar Verificaci√≥n</button>
            </div>
          </div>

          <!-- Estado de la verificaci√≥n -->
          <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
            <div class="flex items-center">
              <i class="fas fa-check-circle text-green-500 text-xl mr-3 hidden" id="veriff-success-icon"></i>
              <i class="fas fa-spinner fa-spin text-yellow-500 text-xl mr-3 hidden" id="veriff-loading-icon"></i>
              <i class="fas fa-times-circle text-red-500 text-xl mr-3 hidden" id="veriff-error-icon"></i>
              <div>
                <span id="veriff-status" class="text-gray-700">Verificaci√≥n pendiente</span>
                <p class="text-xs text-gray-500 mt-1" id="veriff-details">No iniciada</p>
              </div>
            </div>
            <input type="hidden" id="veriff-session-id"/>
            <input type="hidden" id="veriff-verification-id"/>
          </div>
        </section>

        <!-- Pasos 3-5 (simplificados) -->
        <section id="step-3" class="step hidden"><h3 class="text-2xl font-bold text-gray-800 mb-6"><i class="fas fa-file-alt mr-3 text-purple-500"></i>Informaci√≥n Profesional</h3><textarea placeholder="Describe tu experiencia..." class="w-full h-40 px-4 py-3 border border-gray-300 rounded-lg"></textarea></section>
        <section id="step-4" class="step hidden"><h3 class="text-2xl font-bold text-gray-800 mb-6"><i class="fas fa-file-certificate mr-3 text-red-500"></i>Documentos</h3><p class="text-gray-600">Documentos opcionales para profesionales titulados.</p></section>
        <section id="step-5" class="step hidden"><h3 class="text-2xl font-bold text-gray-800 mb-6"><i class="fas fa-clipboard-check mr-3 text-green-500"></i>Revisi√≥n Final</h3><div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6"><div class="flex items-start"><i class="fas fa-exclamation-triangle text-yellow-500 text-xl mr-3 mt-1"></i><div><h4 class="font-bold text-yellow-800 mb-2">Confirmaci√≥n final</h4><p class="text-yellow-700 mb-4">Al enviar, confirmas que la informaci√≥n es ver√≠dica.</p><div class="flex items-center"><input type="checkbox" id="terms-accept" required class="w-5 h-5 text-yellow-600 rounded"/><label for="terms-accept" class="ml-2 text-gray-700">Acepto t√©rminos y condiciones</label></div></div></div></div></section>

        <!-- Navegaci√≥n -->
        <div class="flex justify-between pt-8 border-t border-gray-200">
          <button type="button" id="prev-btn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition hidden"><i class="fas fa-arrow-left mr-2"></i>Anterior</button>
          <button type="button" id="next-btn" class="ml-auto btn-primary px-8 py-3 rounded-lg font-bold">Siguiente <i class="fas fa-arrow-right ml-2"></i></button>
          <button type="submit" id="submit-btn" class="btn-primary px-8 py-3 rounded-lg font-bold hidden"><i class="fas fa-paper-plane mr-2"></i>Enviar</button>
        </div>
      </form>
    </div>

    <!-- Modal de √©xito -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="glass-card rounded-xl p-8 max-w-md w-full mx-4">
        <div class="text-center">
          <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"><i class="fas fa-check text-4xl text-green-500"></i></div>
          <h3 class="text-2xl font-bold text-gray-800 mb-4">¬°Verificaci√≥n Completada!</h3>
          <p class="text-gray-600 mb-6">Tu identidad ha sido verificada exitosamente.</p>
          <button onclick="window.location.href='index.html'" class="btn-primary px-8 py-3 rounded-lg font-bold"><i class="fas fa-home mr-2"></i>Volver al Inicio</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white mt-12"><div class="container mx-auto px-4 py-8"><div class="flex flex-col md:flex-row justify-between items-center"><div class="mb-6 md:mb-0"><div class="flex items-center space-x-3"><i class="fas fa-bee text-2xl text-yellow-400"></i><span class="text-xl font-bold">COLMENA HUB</span></div><p class="text-gray-400 mt-2">Conectando profesionales confiables</p></div><div class="text-center md:text-right"><p class="text-gray-400">¬© 2024 COLMENA HUB</p></div></div></div></footer>

  <!-- ====== JAVASCRIPT ====== -->
  <script>
  // DATOS DE PROFESIONES Y OFICIOS
  const PROFESSION_CATEGORIES = {
    "√ÅREA I: F√≠sico-Matem√°ticas e Ingenier√≠as": [
      "Actuar√≠a","Arquitectura","Arquitectura de Paisaje","Ciencia de Materiales Sustentables",
      "Ciencias Atmosf√©ricas","Ciencias de la Computaci√≥n","Ciencias de la Tierra","Computaci√≥n",
      "F√≠sica","F√≠sica Biom√©dica","Geociencias","Ingenier√≠a Aeroespacial","Ingenier√≠a Aeron√°utica",
      "Ingenier√≠a Agr√≠cola","Ingenier√≠a Ambiental","Ingenier√≠a Biom√©dica","Ingenier√≠a Bi√≥nica",
      "Ingenier√≠a Bioqu√≠mica","Ingenier√≠a Biotecnol√≥gica","Ingenier√≠a Civil","Ingenier√≠a de Minas y Metalurgia",
      "Ingenier√≠a El√©ctrica","Ingenier√≠a Electr√≥nica","Ingenier√≠a El√©ctrica y Electr√≥nica",
      "Ingenier√≠a en Alimentos","Ingenier√≠a en Computaci√≥n","Ingenier√≠a en Control y Automatizaci√≥n",
      "Ingenier√≠a en Energ√≠a","Ingenier√≠a en Energ√≠as Renovables","Ingenier√≠a en Inteligencia Artificial",
      "Ingenier√≠a en Rob√≥tica Industrial","Ingenier√≠a en Sistemas Automotrices","Ingenier√≠a en Telecomunicaciones",
      "Ingenier√≠a en Telecomunicaciones, Sistemas y Electr√≥nica","Ingenier√≠a Farmac√©utica",
      "Ingenier√≠a Ferroviaria","Ingenier√≠a Fot√≥nica","Ingenier√≠a Geof√≠sica","Ingenier√≠a Geol√≥gica",
      "Ingenier√≠a Geom√°tica","Ingenier√≠a Hidrol√≥gica","Ingenier√≠a Industrial","Ingenier√≠a Inform√°tica",
      "Ingenier√≠a Matem√°tica","Ingenier√≠a Mec√°nica","Ingenier√≠a Mec√°nica El√©ctrica","Ingenier√≠a Mecatr√≥nica",
      "Ingenier√≠a Metal√∫rgica","Ingenier√≠a Petrolera","Ingenier√≠a Qu√≠mica","Ingenier√≠a Qu√≠mica Industrial",
      "Ingenier√≠a Qu√≠mica Metal√∫rgica","Ingenier√≠a Qu√≠mica Petrolera","Ingenier√≠a Sistemas Ambientales",
      "Ingenier√≠a Sistemas Computacionales","Ingenier√≠a Sistemas Energ√©ticos y Redes Inteligentes",
      "Ingenier√≠a Telem√°tica","Ingenier√≠a Topogr√°fica y Fotogram√©trica","Ingenier√≠a Transporte",
      "Matem√°ticas","Matem√°ticas Aplicadas","Matem√°ticas Aplicadas y Computaci√≥n","Matem√°ticas para el Desarrollo",
      "Nanotecnolog√≠a","Tecnolog√≠a","Tecnolog√≠as para la Informaci√≥n en Ciencias","Urbanismo"
    ],
    "√ÅREA II: Ciencias Biol√≥gicas, Qu√≠micas y de la Salud": [
      "Agronom√≠a","Bioqu√≠mica Diagn√≥stica","Biolog√≠a","Ciencia de la Nutrici√≥n Humana",
      "Ciencia Forense","Ciencias Agroforestales","Ciencias Agrogen√≥micas","Ciencias Ambientales",
      "Ciencias Gen√≥micas","Ecolog√≠a","Enfermer√≠a","Enfermer√≠a y Obstetricia","Estomatolog√≠a",
      "Farmacia","Fisioterapia","Investigaci√≥n Biom√©dica B√°sica","Manejo Sustentable de Zonas Costeras",
      "Medicina","Medicina Veterinaria y Zootecnia","M√©dico Cirujano","M√©dico Cirujano Home√≥pata",
      "M√©dico Cirujano Partero","Neurociencias","Nutrici√≥n Humana","Nutriolog√≠a","Odontolog√≠a",
      "Optometr√≠a","√ìrtesis y Pr√≥tesis","Qu√≠mica","Qu√≠mica de Alimentos","Qu√≠mica Farmac√©utica Biol√≥gica",
      "Qu√≠mico Bacteri√≥logo y Parasit√≥logo","Qu√≠mico Farmac√©utico Industrial"
    ],
    "√ÅREA III: Ciencias Sociales": [
      "Administraci√≥n","Administraci√≥n Agropecuaria","Administraci√≥n de Archivos y Gesti√≥n Documental",
      "Administraci√≥n Industrial","Administraci√≥n y Desarrollo Empresarial","Antropolog√≠a",
      "Bibliotecolog√≠a y Estudios de la Informaci√≥n","Ciencias de la Comunicaci√≥n",
      "Ciencias Pol√≠ticas y Administraci√≥n P√∫blica","Comunicaci√≥n","Comunicaci√≥n Social",
      "Comunicaci√≥n y Periodismo","Contadur√≠a","Contadur√≠a y Finanzas P√∫blicas","Derecho",
      "Desarrollo Comunitario para el Envejecimiento","Desarrollo Territorial","Econom√≠a",
      "Econom√≠a Industrial","Estudios Sociales y Gesti√≥n Local","Geograf√≠a","Geograf√≠a Aplicada",
      "Geohistoria","Inform√°tica","Mercadotecnia Digital","Movilidad Urbana",
      "Negocios Energ√©ticos Sustentables","Negocios Internacionales","Planeaci√≥n Territorial",
      "Planificaci√≥n para el Desarrollo Agropecuario","Pol√≠tica y Gesti√≥n Social","Psicolog√≠a",
      "Relaciones Comerciales","Relaciones Internacionales","Sociolog√≠a","Sociolog√≠a Aplicada",
      "Trabajo Social","Turismo y Desarrollo Sostenible"
    ],
    "√ÅREA IV: Humanidades y Artes": [
      "Arte y Dise√±o","Artes Visuales","Canto","Composici√≥n","Desarrollo y Gesti√≥n Interculturales",
      "Dise√±o de la Comunicaci√≥n Gr√°fica","Dise√±o Gr√°fico","Dise√±o Industrial","Dise√±o y Comunicaci√≥n Visual",
      "Educaci√≥n Musical","Ense√±anza de Ingl√©s","Ense√±anza de Espa√±ol como Lengua Extranjera",
      "Ense√±anza de Ingl√©s como Lengua Extranjera","Estudios Latinoamericanos","Etnomusicolog√≠a",
      "Filosof√≠a","Historia","Historia del Arte","Instrumentista","Lengua y Literaturas Hisp√°nicas",
      "Lengua y Literaturas Modernas Alemanas","Lengua y Literaturas Modernas Francesas",
      "Lengua y Literaturas Modernas Inglesas","Lengua y Literaturas Modernas Italianas",
      "Lengua y Literaturas Modernas Portuguesas","Letras Cl√°sicas","Ling√º√≠stica Aplicada",
      "Literatura Dram√°tica y Teatro","Literatura Intercultural","M√∫sica y Tecnolog√≠a Art√≠stica",
      "Pedagog√≠a","Piano","Teatro y Actuaci√≥n","Traducci√≥n"
    ],
    "üßπ Limpieza, Mantenimiento y Servicios Generales": [
      "Afinador de pianos","Afilador de cuchillos","Ama de llaves","Boleador","Cargador",
      "Fumigador","Limpia piscinas","Limpia vidrios","Mucama","Personal de limpieza",
      "Portero","Recolecci√≥n de basura","Retiro de escombros"
    ],
    "üèóÔ∏è Construcci√≥n, Oficios T√©cnicos y Reparaci√≥n": [
      "Alba√±il","Blindador","Carpintero","Cerrajero","Chalan","Electricista (t√©cnico)",
      "Herrero","Mec√°nico","Pintor","Plomero","T√©cnico en climatizaci√≥n","T√©cnico en refrigeraci√≥n",
      "T√©cnicos en reparaci√≥n","T√©cnico industrial","Tornero (antes: 'tornador')","Vidriero","Zapatero"
    ],
    "üöö Transporte, Log√≠stica y Mensajer√≠a": [
      "Chofer","Gr√∫as (operador de gr√∫a)","Mensajero","Mudanzas","Personal de almac√©n","Valet parking"
    ],
    "üçΩÔ∏è Alimentos, Bebidas y Servicios de Restaurante": [
      "Ayudante de cocina","Barista","Bartender","Carnicero","Cocinero","Comida para eventos (servicio de catering)",
      "Hostess","Lavaplatos","Mesero","Panadero","Parrillero","Repostero","Sommelier","Tortillero"
    ],
    "üíÑ Belleza, Est√©tica y Bienestar": [
      "Barbero","Estilista","Groomer (estilista canino)","Manicurista","Maquillista","Masajista","Tatuador"
    ],
    "üé® Artes, Dise√±o y Oficios Art√≠sticos": [
      "Actor","Actor de doblaje","Alfarero","Animador de fiestas","Artesano de fibras vegetales",
      "Bailar√≠n / Bailarina","Bordador","Cantante","Ceramista","Creador de contenido",
      "Decorador de interiores","Dise√±o de modas","Escritor","Fot√≥grafo","Joyero",
      "M√∫sico / Bandas","Modelos","Orfebre","Serigrafista","Tallador de piedra","Tejedor"
    ],
    "üê∂ Cuidado de Personas y Animales": [
      "Entrenador canino","Gericultor (cuidado de adultos mayores)","Ni√±era","Paseador de perros"
    ],
    "üèãÔ∏è Deportes, Entrenamiento e Instrucci√≥n": [
      "√Årbitro de ajedrez","√Årbitro de f√∫tbol","√Årbitro de f√∫tbol americano","√Årbitro de hockey",
      "√Årbitro de voleibol","Entrenador de armwrestling","Entrenador de boxeo","Entrenador de calistenia",
      "Entrenador de f√∫tbol","Entrenador de gimnasia","Entrenador personal","Instructor de buceo",
      "Instructor de paracaidismo","Maestro de yoga","Maestro de zumba"
    ],
    "üè• Salud y Laboratorio": [
      "Criminalista","Experto en higiene forense","Laboratorista dental","Optometrista",
      "Radi√≥logo","T√©cnico dental","T√©cnicos en laboratorio"
    ],
    "üßæ Administraci√≥n, Finanzas y Oficina": [
      "Archivista","Asistente administrativa","Asistente personal","Cajero","Corrector de texto",
      "L√≠der sindical","Representante de atenci√≥n al cliente","T√©cnico de RRHH","T√©cnico en contabilidad",
      "T√©cnico en finanzas","T√©cnico en inform√°tica","Valuador","Vendedor"
    ],
    "üõ°Ô∏è Seguridad, Emergencias e Investigaci√≥n": [
      "Bombero","Guardaespaldas","Inspector privado","Personal de seguridad","Vigilante"
    ],
    "üåæ Campo y Producci√≥n": [
      "Agricultor","Apicultor","Granjero"
    ],
    "üéâ Eventos, Turismo y Servicios Especiales": [
      "Agente aduanal","Agente de viajes","Botarguero","Cambiador de publicidad","Enterrador",
      "Gu√≠a de turistas","Mayordomo","Organizador de eventos","Sustituto de filas","Uf√≥logo"
    ]
  };

  // VARIABLES GLOBALES
  let currentStep = 1;
  const totalSteps = 5;
  let veriffInstance = null;
  let verificationCompleted = false;
  let veriffSessionId = null;
  let currentCountry = "mx"; // "mx" o "co"
  let selectedProfession = "";
  let currentProfessionIndex = -1;
  let visibleProfessionOptions = [];

  // ====== FUNCIONES DE FORMATO Y VALIDACI√ìN ======

  // 1. Formatear nombre: "emilio perez jarquin" ‚Üí "Emilio Perez Jarquin"
  function formatName(input) {
    let value = input.value.trim();
    // Convertir a formato capitalizado (primera letra may√∫scula, resto min√∫scula)
    value = value.toLowerCase().split(' ')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
    
    input.value = value;
    
    // Validar que tenga al menos nombre y apellido
    const words = value.split(/\s+/).filter(w => w.length > 0);
    const errorEl = document.getElementById('fullName-error');
    
    if (words.length < 2) {
      errorEl.style.display = 'block';
      input.classList.add('error-input');
      input.classList.remove('success-input');
    } else {
      errorEl.style.display = 'none';
      input.classList.remove('error-input');
      input.classList.add('success-input');
    }
  }

  // 2. Validar solo Gmail
  function validateGmail(input) {
    const email = input.value.trim();
    const errorEl = document.getElementById('email-error');
    const gmailRegex = /^[a-zA-Z0-9._%+-]+@gmail\.com$/i;
    
    if (!gmailRegex.test(email)) {
      errorEl.style.display = 'block';
      input.classList.add('error-input');
      input.classList.remove('success-input');
    } else {
      errorEl.style.display = 'none';
      input.classList.remove('error-input');
      input.classList.add('success-input');
    }
  }

  // ====== FUNCIONES DE PROFESIONES (CON NAVEGACI√ìN POR TECLADO) ======

// Cargar todas las profesiones en el dropdown
function loadProfessions() {
  const dropdown = document.getElementById('profession-dropdown');
  dropdown.innerHTML = '';
  
  for (const [category, professions] of Object.entries(PROFESSION_CATEGORIES)) {
    // Header de categor√≠a
    const header = document.createElement('div');
    header.className = 'category-header text-sm sticky top-0 z-10';
    header.textContent = category;
    dropdown.appendChild(header);
    
    // Opciones de la categor√≠a
    professions.forEach(profession => {
      const option = document.createElement('div');
      option.className = 'professional-option px-4 py-3 cursor-pointer hover:bg-yellow-50 border-b border-gray-100';
      option.textContent = profession;
      option.dataset.value = profession;
      option.onclick = () => selectProfession(profession, option);
      dropdown.appendChild(option);
    });
  }
  
  updateVisibleOptions();
}

// Filtrar profesiones mientras escribe
function filterProfessions() {
  const search = document.getElementById('profession-search').value.toLowerCase().trim();
  const dropdown = document.getElementById('profession-dropdown');
  
  // Mostrar dropdown si est√° oculto
  if (dropdown.classList.contains('hidden')) {
    dropdown.classList.remove('hidden');
  }
  
  // Si no hay b√∫squeda, mostrar todo
  if (!search) {
    dropdown.querySelectorAll('.professional-option, .category-header').forEach(el => {
      el.style.display = 'block';
    });
    updateVisibleOptions();
    return;
  }
  
  // Ocultar todo primero
  dropdown.querySelectorAll('.professional-option, .category-header').forEach(el => {
    el.style.display = 'none';
  });
  
  // Mostrar solo coincidencias
  dropdown.querySelectorAll('.professional-option').forEach(option => {
    if (option.textContent.toLowerCase().includes(search)) {
      option.style.display = 'block';
      
      // Mostrar la categor√≠a correspondiente
      let prev = option.previousElementSibling;
      while (prev && !prev.classList.contains('category-header')) {
        prev = prev.previousElementSibling;
      }
      if (prev && prev.classList.contains('category-header')) {
        prev.style.display = 'block';
      }
    }
  });
  
  // CR√çTICO: Actualizar opciones visibles despu√©s de filtrar
  updateVisibleOptions();
}

// Actualizar lista de opciones visibles (para navegaci√≥n por teclado)
function updateVisibleOptions() {
  const dropdown = document.getElementById('profession-dropdown');
  visibleProfessionOptions = Array.from(
    dropdown.querySelectorAll('.professional-option:not([style*="display: none"])')
  );
  
  // Remover todos los resaltados
  dropdown.querySelectorAll('.professional-option').forEach(option => {
    option.classList.remove('bg-yellow-100', 'font-semibold', 'border-yellow-400');
  });
  
  // Resetear √≠ndice
  currentProfessionIndex = -1;
}

// Navegaci√≥n por teclado
function handleProfessionKeydown(e) {
  const dropdown = document.getElementById('profession-dropdown');
  
  if (dropdown.classList.contains('hidden')) {
    // Si est√° cerrado y presionan flecha abajo, abrir
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      dropdown.classList.remove('hidden');
      if (!dropdown.children.length) loadProfessions();
      updateVisibleOptions();
    }
    return;
  }
  
  switch(e.key) {
    case 'ArrowDown':
      e.preventDefault();
      navigateProfessionDropdown(1);
      break;
    case 'ArrowUp':
      e.preventDefault();
      navigateProfessionDropdown(-1);
      break;
    case 'Enter':
      e.preventDefault();
      if (currentProfessionIndex >= 0 && visibleProfessionOptions[currentProfessionIndex]) {
        selectProfession(
          visibleProfessionOptions[currentProfessionIndex].textContent,
          visibleProfessionOptions[currentProfessionIndex]
        );
      } else if (visibleProfessionOptions.length === 1) {
        // Si solo hay una opci√≥n, seleccionarla
        selectProfession(
          visibleProfessionOptions[0].textContent,
          visibleProfessionOptions[0]
        );
      }
      break;
    case 'Escape':
      e.preventDefault();
      dropdown.classList.add('hidden');
      currentProfessionIndex = -1;
      break;
  }
}

// Navegar con flechas arriba/abajo
function navigateProfessionDropdown(direction) {
  if (visibleProfessionOptions.length === 0) return;
  
  // Remover resaltado anterior
  if (currentProfessionIndex >= 0 && visibleProfessionOptions[currentProfessionIndex]) {
    visibleProfessionOptions[currentProfessionIndex].classList.remove('bg-yellow-100', 'font-semibold', 'border-yellow-400');
  }
  
  // Calcular nuevo √≠ndice (circular)
  currentProfessionIndex += direction;
  if (currentProfessionIndex >= visibleProfessionOptions.length) {
    currentProfessionIndex = 0;
  } else if (currentProfessionIndex < 0) {
    currentProfessionIndex = visibleProfessionOptions.length - 1;
  }
  
  // Resaltar nueva opci√≥n
  const currentOption = visibleProfessionOptions[currentProfessionIndex];
  if (currentOption) {
    currentOption.classList.add('bg-yellow-100', 'font-semibold', 'border-yellow-400');
    currentOption.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
}

// Seleccionar profesi√≥n
function selectProfession(profession, element) {
  selectedProfession = profession;
  document.getElementById('profession').value = profession;
  document.getElementById('profession-search').value = profession;
  document.getElementById('profession-search').classList.add('success-input');
  document.getElementById('profession-search').classList.remove('error-input');
  document.getElementById('profession-error').style.display = 'none';
  
  // Resaltar opci√≥n seleccionada
  document.querySelectorAll('.professional-option').forEach(opt => {
    opt.classList.remove('bg-yellow-100', 'font-semibold', 'border-yellow-400');
  });
  element.classList.add('bg-yellow-100', 'font-semibold', 'border-yellow-400');
  
  // Ocultar dropdown
  document.getElementById('profession-dropdown').classList.add('hidden');
  currentProfessionIndex = -1;
}

// Mostrar/ocultar dropdown
function toggleProfessionDropdown() {
  const dropdown = document.getElementById('profession-dropdown');
  const isHidden = dropdown.classList.contains('hidden');
  
  if (isHidden) {
    dropdown.classList.remove('hidden');
    if (!dropdown.children.length) loadProfessions();
  } else {
    dropdown.classList.add('hidden');
  }
}

  // ====== VALIDACI√ìN COMPLETA PASO 1 ======

  function validateCurrentStep() {
    if (currentStep === 1) {
      // Validar nombre (m√≠nimo 2 palabras)
      const name = document.getElementById('fullName').value.trim();
      if (name.split(/\s+/).filter(w => w.length > 0).length < 2) {
        alert('Por favor escribe tu nombre completo (m√≠nimo nombre y apellido)\nEj: "Emilio Perez Jarquin"');
        document.getElementById('fullName-error').style.display = 'block';
        return false;
      }
      
      // Validar email (solo Gmail)
      const email = document.getElementById('email').value.trim();
      if (!/^[a-zA-Z0-9._%+-]+@gmail\.com$/i.test(email)) {
        alert('Solo se aceptan correos de Gmail (@gmail.com)\nEj: "tuemail@gmail.com"');
        document.getElementById('email-error').style.display = 'block';
        return false;
      }
      
      // Validar tel√©fono (10 d√≠gitos seg√∫n pa√≠s)
      const phone = document.getElementById('phone').value.replace(/\D/g, '');
      if (currentCountry === "mx" && phone.length !== 10) {
        alert('Tel√©fono inv√°lido para M√©xico. Debe tener 10 d√≠gitos\nEj: "5523456789"');
        document.getElementById('phone-error').style.display = 'block';
        return false;
      }
      if (currentCountry === "co" && phone.length !== 10) {
        alert('Tel√©fono inv√°lido para Colombia. Debe tener 10 d√≠gitos\nEj: "3001234567"');
        document.getElementById('phone-error').style.display = 'block';
        return false;
      }
      
      // Validar profesi√≥n seleccionada
      if (!selectedProfession) {
        alert('Por favor selecciona una profesi√≥n/oficio de la lista');
        document.getElementById('profession-error').style.display = 'block';
        return false;
      }
      
      return true;
    }
    
    if (currentStep === 2 && !verificationCompleted) {
      // Iniciar Veriff autom√°ticamente
      startRealVeriff();
      return false; // No avanzar hasta que Veriff complete
    }
    
    if (currentStep === 5 && !document.getElementById('terms-accept').checked) {
      alert('Debes aceptar los t√©rminos y condiciones');
      return false;
    }
    
    return true;
  }

  // ====== NAVEGACI√ìN ENTRE PASOS ======

  function updateProgress() {
    const p = (currentStep / totalSteps) * 100;
    document.getElementById('progress-bar').style.width = p + '%';
    document.getElementById('progress-text').textContent = `${currentStep}/${totalSteps}`;
  }
  
  function updateNav() {
    document.getElementById('prev-btn').classList.toggle('hidden', currentStep === 1);
    document.getElementById('next-btn').classList.toggle('hidden', currentStep === totalSteps);
    document.getElementById('submit-btn').classList.toggle('hidden', currentStep !== totalSteps);
  }
  
  function nextStep() {
    if (!validateCurrentStep()) return;
    document.querySelector(`#step-${currentStep}`).classList.add('hidden');
    currentStep++;
    document.querySelector(`#step-${currentStep}`).classList.remove('hidden');
    updateNav(); 
    updateProgress();
    
    if (currentStep === 2 && !verificationCompleted) {
      // Si Veriff no se ha iniciado, mostrar bot√≥n
      document.getElementById('veriff-placeholder').classList.remove('hidden');
    }
  }
  
  function prevStep() {
    document.querySelector(`#step-${currentStep}`).classList.add('hidden');
    currentStep--;
    document.querySelector(`#step-${currentStep}`).classList.remove('hidden');
    updateNav(); 
    updateProgress();
  }
  
  function submitForm() {
    if (!verificationCompleted) {
      alert('Debes completar la verificaci√≥n de identidad primero');
      return;
    }
    document.getElementById('success-modal').classList.remove('hidden');
  }

  // ====== VERIFF REAL (Cloud Function) ======

  async function startRealVeriff() {
    try {
      const fullName = document.getElementById('fullName').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value.replace(/\D/g, '');
      const countryCode = document.getElementById('country-code').value;
      
      // Mostrar loading
      document.getElementById('veriff-loading-icon').classList.remove('hidden');
      document.getElementById('veriff-status').textContent = 'Preparando verificaci√≥n...';
      
      // Llamar a Cloud Function para crear sesi√≥n
      const createSession = firebase.functions().httpsCallable('createVeriffSession');
      const result = await createSession({
        firstName: fullName.split(' ')[0],
        lastName: fullName.split(' ').slice(1).join(' ') || fullName.split(' ')[0],
        email: email,
        phone: `+${countryCode}${phone}`,
        idNumber: '',
        documentType: 'ID_CARD',
        country: currentCountry === 'mx' ? 'MX' : 'CO'
      });
      
      // Configurar Veriff
      veriffInstance = Veriff({
        host: 'https://stationapi.veriff.com',
        apiKey: '95d2dbf2-2592-4089-860c-10243c087fa0',
        parentId: 'veriff-container',
        onSession: function(err, response) {
          if (err) {
            console.error('Error Veriff:', err);
            document.getElementById('veriff-loading-icon').classList.add('hidden');
            document.getElementById('veriff-error-icon').classList.remove('hidden');
            document.getElementById('veriff-status').textContent = 'Error en verificaci√≥n';
            return;
          }
          
          veriffSessionId = response.verification.id;
          document.getElementById('veriff-session-id').value = veriffSessionId;
          document.getElementById('veriff-verification-id').value = response.verification.id;
          
          // Ocultar placeholder y mostrar estado
          document.getElementById('veriff-placeholder').classList.add('hidden');
          document.getElementById('veriff-loading-icon').classList.add('hidden');
          document.getElementById('veriff-status').textContent = 'Verificaci√≥n en progreso...';
          
          // Monitorear estado
          checkVeriffStatus();
        }
      });
      
      veriffInstance.setParams({
        person: {
          givenName: fullName.split(' ')[0],
          lastName: fullName.split(' ').slice(1).join(' ') || fullName.split(' ')[0],
          idNumber: ''
        }
      });
      
      veriffInstance.mount();
      
    } catch (error) {
      console.error('Error iniciando Veriff:', error);
      document.getElementById('veriff-loading-icon').classList.add('hidden');
      document.getElementById('veriff-error-icon').classList.remove('hidden');
      document.getElementById('veriff-status').textContent = 'Error: ' + (error.message || 'Intenta nuevamente');
      
      // Fallback a simulaci√≥n
      setTimeout(() => {
        simulateVeriffSuccess();
      }, 3000);
    }
  }

  async function checkVeriffStatus() {
    if (!veriffSessionId) return;
    
    try {
      const checkStatus = firebase.functions().httpsCallable('getVeriffStatus');
      const result = await checkStatus({ sessionId: veriffSessionId });
      
      if (result.data.status === 'approved') {
        verificationCompleted = true;
        document.getElementById('veriff-success-icon').classList.remove('hidden');
        document.getElementById('veriff-status').textContent = '‚úÖ Verificaci√≥n completada';
        document.getElementById('veriff-details').textContent = 'Identidad verificada exitosamente';
        document.getElementById('next-btn').disabled = false;
        
        // Guardar en Firestore
        await saveVerificationData();
        
      } else if (result.data.status === 'declined' || result.data.status === 'expired') {
        document.getElementById('veriff-error-icon').classList.remove('hidden');
        document.getElementById('veriff-status').textContent = '‚ùå Verificaci√≥n ' + result.data.status;
        document.getElementById('veriff-details').textContent = 'Por favor intenta nuevamente';
        
      } else {
        // Seguir pendiente, volver a verificar en 5 segundos
        setTimeout(checkVeriffStatus, 5000);
      }
      
    } catch (error) {
      console.error('Error verificando estado:', error);
      setTimeout(checkVeriffStatus, 5000);
    }
  }

  async function saveVerificationData() {
    try {
      const user = firebase.auth().currentUser;
      if (!user) return;
      
      const userData = {
        fullName: document.getElementById('fullName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value.replace(/\D/g, ''),
        countryCode: document.getElementById('country-code').value,
        profession: selectedProfession,
        veriffId: veriffSessionId,
        verificationDate: new Date().toISOString(),
        verified: true,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      await firebase.firestore().collection('verified_professionals').doc(user.uid).set(userData);
      console.log('Datos guardados en Firestore');
      
    } catch (error) {
      console.error('Error guardando datos:', error);
    }
  }

  // Veriff simulado (fallback)
  function simulateVeriffSuccess() {
    verificationCompleted = true;
    document.getElementById('veriff-placeholder').classList.add('hidden');
    document.getElementById('veriff-success-icon').classList.remove('hidden');
    document.getElementById('veriff-status').textContent = '‚úÖ Verificaci√≥n completada';
    document.getElementById('veriff-details').textContent = 'Identidad verificada exitosamente';
    document.getElementById('next-btn').disabled = false;
  }

  // ====== INICIALIZACI√ìN ======

  document.addEventListener('DOMContentLoaded', () => {
    updateProgress(); 
    updateNav();
    
    // Bot√≥n para iniciar Veriff
    document.getElementById('start-veriff-btn').addEventListener('click', startRealVeriff);
    
    // Navegaci√≥n
    document.getElementById('next-btn').addEventListener('click', nextStep);
    document.getElementById('prev-btn').addEventListener('click', prevStep);
    document.getElementById('submit-btn').addEventListener('click', submitForm);
    
    // Formatear nombre al salir del campo
    document.getElementById('fullName').addEventListener('blur', function() {
      formatName(this);
    });
    
    // Validar email al salir del campo
    document.getElementById('email').addEventListener('blur', function() {
      validateGmail(this);
    });
    
    // Cerrar dropdown de profesiones al hacer clic fuera
    document.addEventListener('click', (e) => {
      const dropdown = document.getElementById('profession-dropdown');
      const searchInput = document.getElementById('profession-search');
      
      if (!dropdown.contains(e.target) && e.target !== searchInput) {
        dropdown.classList.add('hidden');
      }
    });
    
    // Inicializar indicador de pa√≠s
    document.getElementById('country-indicator').textContent = '';
    
    // Cargar profesiones al hacer clic en el input
    document.getElementById('profession-search').addEventListener('click', function() {
      const dropdown = document.getElementById('profession-dropdown');
      if (dropdown.classList.contains('hidden')) {
        toggleProfessionDropdown();
      }
    });
    
    // Navegaci√≥n por teclado en el input de b√∫squeda
    document.getElementById('profession-search').addEventListener('keydown', function(e) {
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp' || e.key === 'Enter' || e.key === 'Escape') {
        handleProfessionKeydown(e);
      }
    });
    
    // Permitir tecla Enter en el input para seleccionar
    document.getElementById('profession-search').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && currentProfessionIndex === -1) {
        e.preventDefault();
        const firstOption = document.querySelector('.professional-option[style="display: block"], .professional-option:not([style*="display: none"])');
        if (firstOption) {
          selectProfession(firstOption.textContent, firstOption);
        }
      }
    });
    
    // Configurar Firebase si no est√° inicializado
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey: "AIzaSyAeLIJ8ee9xUBduMKkijW4GdnY45W32Eew",
        authDomain: "colmena-hub.firebaseapp.com",
        projectId: "colmena-hub",
        storageBucket: "colmena-hub.firebasestorage.app",
        messagingSenderId: "806697924814",
        appId: "1:806697924814:web:b11c9b057bc6d1dd71789f"
      });
    }
  });
</script>
</body>
</html>