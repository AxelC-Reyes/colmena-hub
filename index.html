<!-- En el HEAD, despu√©s de los estilos -->
<style>
  /* Estilos b√°sicos para Veriff */
  .veriff-status {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 14px;
  }
  
  .veriff-pending {
    background: #FEF3C7;
    color: #92400E;
  }
  
  .veriff-success {
    background: #D1FAE5;
    color: #065F46;
  }
  
  .veriff-error {
    background: #FEE2E2;
    color: #991B1B;
  }
</style>

<!-- En el BODY, antes del cierre </body> -->
<script src="veriff-simple.js"></script>

<script>
  // ========== CONFIGURACI√ìN SIMPLIFICADA ==========
  
  // Variables globales
  let auth = null;
  let db = null;
  
  // Inicializar Firebase
  function initFirebase() {
    try {
      const firebaseConfig = {
        apiKey: "AIzaSyAeLIJ8ee9xUBduMKkijW4GdnY45W32Eew",
        authDomain: "colmena-hub.firebaseapp.com",
        projectId: "colmena-hub",
        storageBucket: "colmena-hub.firebasestorage.app",
        messagingSenderId: "806697924814",
        appId: "1:806697924814:web:b11c9b057bc6d1dd71789f",
        measurementId: "G-LQ9GLGJCX8"
      };
      
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      
      auth = firebase.auth();
      db = firebase.firestore();
      
      console.log('‚úÖ Firebase inicializado');
      return true;
    } catch (error) {
      console.error('‚ùå Error Firebase:', error);
      return false;
    }
  }
  
  // Manejar login Google
  document.getElementById('btnGoogle').addEventListener('click', async () => {
    if (!auth) {
      alert('Firebase no est√° listo. Recarga la p√°gina.');
      return;
    }
    
    try {
      const provider = new firebase.auth.GoogleAuthProvider();
      const result = await auth.signInWithPopup(provider);
      const user = result.user;
      
      // Guardar en Firestore
      if (db) {
        await db.collection('users').doc(user.uid).set({
          uid: user.uid,
          displayName: user.displayName,
          email: user.email,
          photoURL: user.photoURL,
          lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
          verified: false,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
      }
      
      updateUI(user);
      alert(`¬°Bienvenido ${user.displayName}!`);
      
    } catch (error) {
      console.error('Error login:', error);
      alert('Error: ' + error.message);
    }
  });
  
  // Manejar logout
  document.getElementById('logout-btn')?.addEventListener('click', async () => {
    try {
      await auth.signOut();
      updateUI(null);
    } catch (error) {
      console.error('Error logout:', error);
    }
  });
  
  // Manejar verificaci√≥n Veriff
  document.getElementById('verify-btn').addEventListener('click', async () => {
  const user = auth?.currentUser;
  if (!user) {
    showStatus('Primero inicia sesi√≥n', true);
    return;
  }
  
  showStatus('Iniciando Veriff...');
  
  // Preparar datos del usuario
  const userData = {
    uid: user.uid,
    email: user.email,
    displayName: user.displayName,
    firstName: user.displayName?.split(' ')[0] || 'Usuario',
    lastName: user.displayName?.split(' ').slice(1).join(' ') || 'Test'
  };
  
  // Usar VeriffWorking
  if (window.VeriffWorking) {
    try {
      const sessionId = await window.VeriffWorking.startVerification(userData);
      
      if (sessionId) {
        showStatus('Veriff iniciado. Sigue las instrucciones en pantalla.');
        
        // Guardar sessionId en localStorage para referencia
        localStorage.setItem('veriff_session_id', sessionId);
        localStorage.setItem('veriff_user_id', user.uid);
      }
      
    } catch (error) {
      console.error('Error Veriff:', error);
      showStatus('Error: ' + error.message, true);
    }
  } else {
    showStatus('Veriff no est√° disponible', true);
  }
});
  
  // Actualizar UI
  function updateUI(user) {
    const loginSection = document.getElementById('login-section');
    const userPanel = document.getElementById('user-panel');
    
    if (user) {
      loginSection.classList.add('hidden');
      userPanel.classList.remove('hidden');
      
      document.getElementById('user-name').textContent = user.displayName || 'Usuario';
      document.getElementById('user-email').textContent = user.email || '';
      
      const avatar = document.getElementById('user-avatar');
      if (avatar) {
        avatar.src = user.photoURL || 'https://ui-avatars.com/api/?name=' + 
          encodeURIComponent(user.displayName || 'Usuario') + '&background=FFD700&color=000';
      }
      
      // Mostrar estado de verificaci√≥n
      const verifiedBadge = document.getElementById('verified-badge');
      const verificationBadge = document.getElementById('verification-badge');
      
      if (user.verified) {
        verifiedBadge?.classList.remove('hidden');
        verificationBadge?.classList.add('hidden');
        document.getElementById('verify-btn')?.classList.add('hidden');
      } else {
        verificationBadge?.classList.remove('hidden');
        verifiedBadge?.classList.add('hidden');
        document.getElementById('verify-btn')?.classList.remove('hidden');
      }
      
    } else {
      loginSection.classList.remove('hidden');
      userPanel.classList.add('hidden');
    }
  }
  
  // Observador de autenticaci√≥n
  function setupAuthObserver() {
    if (!auth) return;
    
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        let userData = user;
        
        // Obtener datos de Firestore
        if (db) {
          try {
            const userDoc = await db.collection('users').doc(user.uid).get();
            if (userDoc.exists) {
              userData = { ...user, ...userDoc.data() };
            }
          } catch (error) {
            console.warn('Error Firestore:', error);
          }
        }
        
        updateUI(userData);
      } else {
        updateUI(null);
      }
    });
  }
  
  // Inicializar
  document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ COLMENA HUB cargando...');
    
    // Inicializar Firebase
    if (initFirebase()) {
      setupAuthObserver();
    }
    
    // Verificar si estamos en local
    if (window.location.protocol === 'file:') {
      alert('‚ö†Ô∏è Ejecuta desde: http://localhost:8000');
    }
  });
</script>