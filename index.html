<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COLMENA-HUB</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body{ margin:0; background:#fff; background-color: #f3f4f6; }
    #juego-contenedor{ background:#fff; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,.1); }
    #lienzo-juego{ margin:0 auto; }
    #panel-juego.hidden{ display:none; }
    .logo-container { 
      display: flex; 
      justify-content: center; 
      align-items: center;
      padding: 20px 0 10px 0;
    }
    .logo-img {
      height: 100px;
      width: auto;
      transition: transform 0.3s ease;
    }
    .logo-img:hover {
      transform: scale(1.05);
    }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    /* Barra de estado */
    .status-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 9999;
      padding: 8px 16px;
      text-align: center;
      font-size: 14px;
      display: none;
    }
    .status-bar.visible { display: block; }
    .status-bar.success { background-color: #10B981; color: white; }
    .status-bar.error { background-color: #EF4444; color: white; }
    .status-bar.warning { background-color: #F59E0B; color: white; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

  <!-- Veriff SDK -->
  <script src="https://cdn.veriff.me/v2/veriff.js"></script>

  <!-- Cargar veriff-working.js si existe -->
  <script src="veriff-working.js"></script>
</head>

<body class="min-h-screen bg-offwhite flex flex-col">
  
  <!-- Barra de estado superior (mejora nueva) -->
  <div id="statusBar" class="status-bar">
    <i id="statusIcon" class="fas fa-spinner fa-spin mr-2"></i>
    <span id="statusText">Cargando...</span>
  </div>

  <!-- Contenido principal -->
  <main class="flex-grow flex flex-col items-center justify-center px-4 py-12 space-y-10">
    
    <!-- Logo y T√≠tulo en l√≠nea -->
    <div class="flex flex-row items-center justify-center gap-4 mb-2">
      <!-- Logo al lado izquierdo -->
      <div>
        <img src="colmena-hubLOGO.png" alt="COLMENA HUB Logo" class="h-40 w-auto">
      </div>
      
      <!-- T√≠tulo al lado derecho -->
      <div>
        <h1 class="text-4xl font-bold text-gray-800">COLMENA-HUB</h1>
      </div>
    </div>
    
    <!-- Subt√≠tulo debajo -->
    <p class="text-lg text-gray-600 text-center">QUIERO</p>

    <!-- Hex√°gonos -->
    <div class="flex flex-col md:flex-row items-center justify-center gap-8">
      <a href="professional-type.html"
         class="relative w-48 h-52 flex items-center justify-center text-white font-bold text-xl
                bg-yellow-500 shadow-lg hover:bg-yellow-600 transition-all duration-300"
         style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);">
        CONTRATAR
      </a>

      <a href="apply.html"
         class="relative w-48 h-52 flex items-center justify-center text-white font-bold text-xl
                bg-yellow-500 shadow-lg hover:bg-yellow-600 transition-all duration-300"
         style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);">
        SER CONTRATADO
      </a>
    </div>

    <!-- Bot√≥n con logo de Google (POPUP sin redirigir) -->
    <button id="btnGoogle" class="mt-6 px-5 py-2.5 bg-white text-gray-700 rounded-md border border-gray-300 hover:bg-gray-50 transition inline-flex items-center justify-center gap-2">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" 
           class="w-4 h-4 inline-block align-baseline" 
           alt="Google">
      <span class="inline-block align-middle text-sm">Ingresar con Google</span>
    </button>

    <!-- Bot√≥n flotante Verificar Identidad (solo logueado) -->
    <div id="veriffWrapper" class="fixed bottom-4 right-4 hidden">
      <button id="veriffBtn"
              class="px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition">
        Verificar mi identidad
      </button>
    </div>

    <!-- Badge de verificaci√≥n -->
    <div id="verifiedBadge" class="fixed top-4 right-4 hidden z-50">
      <div class="px-4 py-2 bg-green-100 text-green-800 rounded-full flex items-center gap-2">
        <i class="fas fa-check-circle"></i>
        <span class="font-medium">Verificado</span>
      </div>
    </div>

    <!-- Mini Juego -->
    <div class="mt-8 text-center">
      <h3 class="text-base font-semibold text-yellow-700 mb-2">Mini Juego</h3>
      <a href="juego.html"
         class="inline-block px-4 py-2 bg-yellow-500 text-white text-sm font-medium rounded-lg hover:bg-yellow-600 transition shadow-md">
        Jugar Ahora
      </a>
    </div>
  </main>
    <a href="dashboard.html" class="text-blue-500 hover:text-blue-700">Mi Dashboard</a>
    
  <!-- Footer (se mantiene exactamente igual) -->
  <footer class="w-full bg-gradient-to-b from-gray-50 to-gray-100 border-t border-yellow-200 mt-8">
    <div class="max-w-6xl mx-auto px-4 py-8">
      <!-- Grid principal -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
        <!-- Enlaces legales -->
        <div class="space-y-4">
          <div class="flex items-center gap-2 mb-3">
            <div class="w-6 h-6 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded flex items-center justify-center">
              <i class="fas fa-shield-alt text-white text-xs"></i>
            </div>
            <h3 class="font-bold text-gray-800 text-sm uppercase tracking-wider">Legal</h3>
          </div>
          <div class="space-y-2">
            <a href="politica-privacidad.html" 
               class="flex items-center gap-2 text-gray-600 hover:text-yellow-600 transition-colors group">
              <i class="fas fa-file-contract text-yellow-500 text-xs group-hover:scale-110 transition-transform"></i>
              <span class="text-sm">Pol√≠tica de Privacidad</span>
            </a>
            <a href="#" 
               class="flex items-center gap-2 text-gray-600 hover:text-yellow-600 transition-colors group">
              <i class="fas fa-balance-scale text-yellow-500 text-xs group-hover:scale-110 transition-transform"></i>
              <span class="text-sm">T√©rminos y Condiciones</span>
            </a>
            <a href="#" 
               class="flex items-center gap-2 text-gray-600 hover:text-yellow-600 transition-colors group">
              <i class="fas fa-question-circle text-yellow-500 text-xs group-hover:scale-110 transition-transform"></i>
              <span class="text-sm">Preguntas Frecuentes</span>
            </a>
          </div>
        </div>
        
        <!-- Misi√≥n -->
        <div class="space-y-3">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-6 h-6 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded flex items-center justify-center">
              <i class="fas fa-bullseye text-white text-xs"></i>
            </div>
            <h3 class="font-bold text-gray-800">Misi√≥n</h3>
          </div>
          <p class="text-gray-600 text-sm leading-relaxed">
            Conectar talento con oportunidades de manera simple, segura y confiable, 
            construyendo puentes entre profesionales y oportunidades.
          </p>
        </div>
        
        <!-- Visi√≥n -->
        <div class="space-y-3">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-6 h-6 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded flex items-center justify-center">
              <i class="fas fa-eye text-white text-xs"></i>
            </div>
            <h3 class="font-bold text-gray-800">Visi√≥n</h3>
          </div>
          <p class="text-gray-600 text-sm leading-relaxed">
            Ser la plataforma l√≠der en contrataci√≥n profesional en Latinoam√©rica, 
            transformando la manera en que empresas y profesionales se conectan.
          </p>
        </div>
        
        <!-- Con√≥cenos + Redes -->
        <div class="space-y-4">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-6 h-6 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded flex items-center justify-center">
              <i class="fas fa-users text-white text-xs"></i>
            </div>
            <h3 class="font-bold text-gray-800">Con√≥cenos</h3>
          </div>
          
          <p class="text-gray-600 text-sm mb-4 leading-relaxed">
            Somos un equipo comprometido con el desarrollo profesional y la innovaci√≥n 
            en el mercado laboral.
          </p>
          
          <!-- Redes Sociales -->
          <div>
            <h4 class="font-semibold text-gray-700 text-xs mb-3 uppercase tracking-wider">S√≠guenos</h4>
            <div class="flex space-x-3">
              <!-- Instagram -->
              <a href="https://www.instagram.com/colmena_hub?igsh=cTN3cDBwN3FmMm9k&utm_source=qr" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-purple-600 flex items-center justify-center text-white hover:shadow-lg hover:scale-110 transition-all duration-200"
                 title="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
              
              <!-- LinkedIn -->
              <a href="https://www.linkedin.com/company/colmena-hub/" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="w-10 h-10 rounded-full bg-blue-700 flex items-center justify-center text-white hover:shadow-lg hover:scale-110 transition-all duration-200"
                 title="LinkedIn">
                <i class="fab fa-linkedin-in"></i>
              </a>
              
              <!-- WhatsApp -->
              <a href="https://wa.me/5215512345678" 
                 target="_blank" 
                 rel="noopener noreferrer"
                 class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white hover:shadow-lg hover:scale-110 transition-all duration-200"
                 title="WhatsApp">
                <i class="fab fa-whatsapp"></i>
              </a>
            </div>
          </div>
          
          <!-- Contacto directo -->
          <div class="pt-3 border-t border-gray-200">
            <a href="mailto:contacto@colmena-hub.com" 
               class="flex items-center gap-2 text-gray-600 hover:text-yellow-600 transition-colors text-sm group">
              <i class="fas fa-envelope text-yellow-500 group-hover:animate-bounce"></i>
              <span>contacto@colmena-hub.com</span>
            </a>
          </div>
        </div>
      </div>
      
      <!-- L√≠nea divisoria -->
      <div class="h-px bg-gradient-to-r from-transparent via-yellow-300 to-transparent my-6"></div>
      
      <!-- Copyright y marca -->
      <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-bee text-white"></i>
          </div>
          <div>
            <div class="font-bold text-gray-800 text-lg">COLMENA HUB</div>
            <div class="text-xs text-gray-500">Conectando talento, construyendo futuro</div>
          </div>
        </div>
        
        <div class="text-center md:text-right">
          <div class="text-xs text-gray-500 mb-1">
            ¬© 2025 Colmena-Hub. Todos los derechos reservados.
          </div>
          <div class="flex items-center justify-center md:justify-end gap-4 text-xs text-gray-500">
            <span class="flex items-center gap-1">
              <i class="fas fa-shield-alt text-green-500"></i>
              <span>100% Seguro</span>
            </span>
            <span class="flex items-center gap-1">
              <i class="fas fa-lock text-blue-500"></i>
              <span>Encriptaci√≥n SSL</span>
            </span>
            <span class="flex items-center gap-1">
              <i class="fas fa-check-circle text-yellow-500"></i>
              <span>Profesionales Verificados</span>
            </span>
          </div>
        </div>
      </div>
      
      <!-- Badge de seguridad m√≥vil -->
      <div class="md:hidden mt-4 flex justify-center">
        <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-yellow-50 border border-yellow-200 rounded-full">
          <i class="fas fa-shield-alt text-yellow-600"></i>
          <span class="text-xs text-gray-700">Plataforma segura y verificada</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts de juego (se mantienen) -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.min.js"></script>
  <script src="preguntas.js"></script>
  <script src="mini-juego.js"></script>
  <script src="sketch.js"></script>
  <script src="juego-logica.js"></script>

  <script>
    // ========== CONFIGURACI√ìN GLOBAL MEJORADA ==========
    
    // Variables globales
    let auth = null;
    let db = null;
    let storage = null;
    let firebaseInitialized = false;
    
    // Config Firebase (la misma)
    const firebaseConfig = {
      apiKey: "AIzaSyAeLIJ8ee9xUBduMKkijW4GdnY45W32Eew",
      authDomain: "colmena-hub.firebaseapp.com",
      projectId: "colmena-hub",
      storageBucket: "colmena-hub.firebasestorage.app",
      messagingSenderId: "806697924814",
      appId: "1:806697924814:web:b11c9b057bc6d1dd71789f",
      measurementId: "G-LQ9GLGJCX8"
    };
    
    // ========== FUNCIONES UTILITARIAS ==========
    
    function showStatus(message, type = 'info') {
      const bar = document.getElementById('statusBar');
      const text = document.getElementById('statusText');
      const icon = document.getElementById('statusIcon');
      
      if (!bar || !text || !icon) return;
      
      // Reset clases
      bar.className = 'status-bar';
      
      // Configurar seg√∫n tipo
      let iconClass = '';
      switch(type) {
        case 'success':
          bar.classList.add('success');
          iconClass = 'fa-check-circle';
          break;
        case 'error':
          bar.classList.add('error');
          iconClass = 'fa-exclamation-circle';
          break;
        case 'warning':
          bar.classList.add('warning');
          iconClass = 'fa-exclamation-triangle';
          break;
        default:
          bar.classList.add('warning');
          iconClass = 'fa-spinner fa-spin';
          break;
      }
      
      // Actualizar contenido
      icon.className = `fas ${iconClass} mr-2`;
      text.textContent = message;
      bar.classList.add('visible');
      
      // Auto-ocultar si no es error
      if (type !== 'error') {
        setTimeout(() => {
          bar.classList.remove('visible');
        }, 3000);
      }
    }
    
    // ========== INICIALIZACI√ìN FIREBASE MEJORADA ==========
    
    function initializeFirebase() {
      try {
        console.log('üî• Inicializando Firebase...');
        
        // Verificar si estamos en local (file://)
        if (window.location.protocol === 'file:') {
          showStatus('‚ö†Ô∏è Ejecuta desde http://localhost:8000', 'warning');
          document.getElementById('btnGoogle').disabled = true;
          document.getElementById('btnGoogle').innerHTML = '<span>Ejecuta desde localhost</span>';
          document.getElementById('btnGoogle').classList.add('opacity-50', 'cursor-not-allowed');
          return false;
        }
        
        // Inicializar Firebase solo si no existe
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
          console.log('‚úÖ Firebase inicializado');
        }
        
        // Obtener referencias
        auth = firebase.auth();
        db = firebase.firestore();
        storage = firebase.storage();
        firebaseInitialized = true;
        
        console.log('‚úÖ Firebase Auth y Firestore listos');
        showStatus('Sistema listo. Inicia sesi√≥n para comenzar.', 'success');
        return true;
        
      } catch (error) {
        console.error('‚ùå Error inicializando Firebase:', error);
        showStatus(`Error Firebase: ${error.message}`, 'error');
        return false;
      }
    }
    
    // ========== MANEJO DE AUTENTICACI√ìN MEJORADO ==========
    
    async function handleGoogleLogin() {
      console.log('üü° Iniciando login con Google...');
      
      if (!firebaseInitialized || !auth) {
        showStatus('Error: Firebase no est√° listo. Recarga la p√°gina.', 'error');
        return;
      }
      
      showStatus('Conectando con Google...', 'info');
      
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('email');
        provider.addScope('profile');
        
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        
        console.log('‚úÖ Login exitoso:', user.email);
        
        // Guardar usuario en Firestore
        if (db) {
          try {
            await db.collection('users').doc(user.uid).set({
              uid: user.uid,
              displayName: user.displayName,
              email: user.email,
              photoURL: user.photoURL,
              lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
              verified: false,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
            console.log('‚úÖ Usuario guardado en Firestore');
          } catch (firestoreError) {
            console.warn('‚ö†Ô∏è Error Firestore (permisos?):', firestoreError);
          }
        }
        
        showStatus(`¬°Bienvenido ${user.displayName}!`, 'success');
        
      } catch (error) {
        console.error('‚ùå Error en login Google:', error);
        
        if (error.code === 'auth/operation-not-supported-in-this-environment') {
          showStatus('‚ö†Ô∏è Ejecuta desde http://localhost:8000', 'warning');
        } else if (error.code === 'auth/popup-blocked') {
          showStatus('‚ö†Ô∏è Ventana emergente bloqueada. Permite popups.', 'warning');
        } else if (error.code === 'auth/popup-closed-by-user') {
          showStatus('Ventana cerrada por el usuario', 'info');
        } else {
          showStatus(`Error: ${error.message}`, 'error');
        }
      }
    }
    
    async function handleLogout() {
      try {
        await auth.signOut();
        showStatus('Sesi√≥n cerrada correctamente', 'success');
      } catch (error) {
        showStatus(`Error: ${error.message}`, 'error');
      }
    }
    
    // ========== VERIFICACI√ìN VERIFF MEJORADA ==========
    
    async function handleVerification() {
      const user = auth?.currentUser;
      if (!user) {
        showStatus('Primero inicia sesi√≥n', 'warning');
        return;
      }
      
      showStatus('Iniciando verificaci√≥n de identidad...', 'info');
      
      // Usar VeriffWorking si est√° disponible
      if (window.VeriffWorking) {
        try {
          const userData = {
            uid: user.uid,
            email: user.email,
            displayName: user.displayName,
            firstName: user.displayName?.split(' ')[0] || 'Usuario',
            lastName: user.displayName?.split(' ').slice(1).join(' ') || 'Test'
          };
          
          console.log('üöÄ Llamando VeriffWorking...');
          const sessionId = await window.VeriffWorking.startVerification(userData);
          
          if (sessionId) {
            showStatus('Veriff iniciado. Sigue las instrucciones en pantalla.', 'success');
            
            // Guardar sessionId en localStorage
            localStorage.setItem('veriff_session_id', sessionId);
            localStorage.setItem('veriff_user_id', user.uid);
          }
          
        } catch (error) {
          console.error('‚ùå Error Veriff:', error);
          showStatus('Error: ' + error.message, 'error');
          
          // Fallback a simulaci√≥n
          simulateVerification(user);
        }
      } else {
        // Veriff no disponible, usar simulaci√≥n
        simulateVerification(user);
      }
    }
    
    async function simulateVerification(user) {
      showStatus('‚ö†Ô∏è Usando simulaci√≥n de verificaci√≥n...', 'warning');
      
      // Simular delay
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      try {
        if (db) {
          await db.collection('users').doc(user.uid).update({
            verified: true,
            verifiedAt: firebase.firestore.FieldValue.serverTimestamp(),
            verificationMethod: 'simulated'
          });
        }
        
        showStatus('‚úÖ ¬°Identidad verificada exitosamente!', 'success');
        
        // Actualizar UI
        document.getElementById('verifiedBadge').classList.remove('hidden');
        document.getElementById('veriffBtn').classList.add('hidden');
        
      } catch (error) {
        console.error('Error en simulaci√≥n:', error);
        showStatus('Error: ' + error.message, 'error');
      }
    }
    
    // ========== GESTI√ìN DE INTERFAZ ==========
    
    async function checkVerificationStatus(user) {
      if (!user || !db) return;
      
      try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (userDoc.exists) {
          const userData = userDoc.data();
          if (userData.verified) {
            document.getElementById('verifiedBadge').classList.remove('hidden');
            document.getElementById('veriffBtn').classList.add('hidden');
          }
        }
      } catch (error) {
        console.error('Error verificando estado:', error);
      }
    }
    
    function updateUI(user) {
      const btnGoogle = document.getElementById('btnGoogle');
      const veriffWrapper = document.getElementById('veriffWrapper');
      const veriffBtn = document.getElementById('veriffBtn');
      
      if (user) {
        // Usuario logueado
        btnGoogle.style.display = 'none';
        veriffWrapper.style.display = 'block';
        
        // Verificar si ya est√° verificado
        checkVerificationStatus(user);
        
        // Configurar bot√≥n de verificaci√≥n
        if (veriffBtn) {
          veriffBtn.onclick = handleVerification;
        }
        
      } else {
        // Usuario no logueado
        btnGoogle.style.display = 'inline-flex';
        veriffWrapper.style.display = 'none';
        document.getElementById('verifiedBadge').classList.add('hidden');
      }
    }
    
    // ========== OBSERVADOR DE AUTENTICACI√ìN ==========
    
    function setupAuthObserver() {
      if (!auth) return;
      
      auth.onAuthStateChanged(async (user) => {
        console.log('üîÑ Estado de autenticaci√≥n:', user ? user.email : 'NO USER');
        updateUI(user);
      });
    }
    
    // ========== INICIALIZACI√ìN DE LA P√ÅGINA ==========
    
    function initializePage() {
      console.log('üöÄ COLMENA HUB - Inicializando...');
      
      // 1. Inicializar Firebase
      if (initializeFirebase()) {
        // 2. Configurar bot√≥n Google
        const btnGoogle = document.getElementById('btnGoogle');
        if (btnGoogle) {
          btnGoogle.addEventListener('click', handleGoogleLogin);
        }
        
        // 3. Configurar observador de autenticaci√≥n
        setupAuthObserver();
        
        // 4. Verificar estado inicial
        const initialUser = auth.currentUser;
        if (initialUser) {
          updateUI(initialUser);
        }
        
        console.log('‚úÖ P√°gina inicializada correctamente');
      }
    }
    
    // Inicializar cuando el DOM est√© listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializePage);
    } else {
      initializePage();
    }
  </script>
</body>
</html>